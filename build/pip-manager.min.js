/**
 * @license
 * pip-manager
 * @author danrossi / https://github.com/danrossi
 * Copyright (c) 2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var pip=function(e){"use strict";const t=new WeakMap;class i{constructor(){t.set(this,{})}on(e,i){const n=t.get(this);return n[e]||(n[e]=[]),n[e].push(i),this}once(e,t){const i=(...n)=>{this.off(e,i),t(...n)};return this.on(e,i),this}off(e,i){const n=t.get(this)[e];return n&&(null===i?n.length=0:n.splice(n.indexOf(i),1)),this}listeners(e){try{return t.get(this)[e]}catch(e){return null}}emit(e,...i){const n=t.get(this)[e];return n&&n.length?(n.forEach((t=>{t({type:e,target:this},...i)})),!0):this}emitAsync(e,...i){const n=t.get(this)[e],r=[];return n&&n.length&&n.forEach((t=>{r.push(t({type:e,target:this},...i))})),Promise.all(r)}}let n,r=!1,s=!1;class o{static get supported(){return r="pictureInPictureEnabled"in document,s="webkitSupportsPresentationMode"in HTMLVideoElement.prototype,r||s}static get webkitSupport(){return s}static get chromeSupport(){return r}}return e.PictureInPictureManager=class extends i{constructor(){super(),this.pictureInPictureElement=!1}initVideo(){const e=()=>{this.emit("disabled",0===this.videoEl.readyState||this.videoEl.disablePictureInPicture)};e(),this.videoEl.addEventListener("loadedmetadata",e),this.videoEl.addEventListener("emptied",e)}set video(e){this.videoEl=e,this.initVideo()}init(e){this.video=e,o.webkitSupport?this.initWebkitEvents():this.initChromeEvents()}initWebkitEvents(){document.addEventListener("webkitpresentationmodechanged",(e=>this.onWebkitPresentationChanged(e)),!0)}initChromeEvents(){this.videoEl.addEventListener("enterpictureinpicture",(e=>{n=e.pictureInPictureWindow,this.emit("enterpictureinpicture",n),this.onPipWindowResizeRef=()=>this.onPipWindowResize(),n.addEventListener("resize",this.onPipWindowResizeRef)})),this.videoEl.addEventListener("leavepictureinpicture",(e=>{this.emit("leavepictureinpicture"),n.removeEventListener("resize",this.onPipWindowResizeRef)}))}onWebkitPresentationChanged(e){const t=e.target;"picture-in-picture"==t.webkitPresentationMode?this.emit("enterpictureinpicture",t):document.pictureInPictureElement==t&&this.emit("leavepictureinpicture")}onPipWindowResize(e){this.emit("resize",e)}toggleChromePip(){document.pictureInPictureElement?document.exitPictureInPicture().catch((e=>{this.emit("failed",e)})):this.videoEl.requestPictureInPicture().catch((e=>{this.emit("failed",e)}))}toggleWebkitPip(){!document.pictureInPictureElement&&this.videoEl.webkitSupportsPresentationMode("picture-in-picture")?this.videoEl.webkitSetPresentationMode("picture-in-picture"):this.videoEl.webkitSetPresentationMode("inline")}togglePictureInPicture(){o.webkitSupport?this.toggleWebkitPip():this.toggleChromePip()}},e.PictureInPictureUtil=o,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
